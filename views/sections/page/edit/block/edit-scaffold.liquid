{% liquid
  assign attributes = blueprint.attributes
  assign fields = blueprint.fields
  assign items = blueprint.items
%}

<div class="w-full">
  {%- liquid
    render 'page/edit/scaffold-input', items: attributes, key: "@", prefix: prefix, inputs: inputs, placeholders: placeholder, values: tokens, icon: 'gear', form: "main-form"
    render 'page/edit/scaffold-input', items: fields, key: ".", prefix: prefix, inputs: inputs, placeholders: placeholder, values: tokens, icon: '', form: "main-form"
  -%}

  <!-- items -->
  <div class="pt-1">
    {% for item in items %}
      {%- liquid
        assign item_name = item.name
        assign item_label = item.name | capitalize
        assign default_items = " " |  split: ","
        assign page_items = tokens[item_name] | default: default_items
        assign page_items = page_items | sort : "_weight"
        assign key = "#" | append: block_index | append: item_name | md5
      -%}
      <label class="text-xl font-serif me-2" for="{{ key }}"><i class="far fa-copy me-2"></i>{{ item_label }}</label>
      <input type="checkbox" class="peer hidden" data-state-store="true" checked id="{{ key }}">
      <label for="{{ key }}" class="select-none cursor-pointer float-end peer-checked:hidden inline"><i class="fa-thin fa-chevron-down"></i></label>
      <label for="{{ key }}" class="select-none cursor-pointer float-end peer-checked:inline hidden"><i class="fa-thin fa-chevron-up"></i></label>

      <div class="hidden peer-checked:block mt-3">
        {% for page_item in page_items %}
          {% capture prefix %}#{{ block_index }}.{{ item_name }}[{{ page_item._key }}]{% endcapture %}

          <div class="flex flex-row mb-3">
            {% render "page/edit/item/weight", prefix: prefix, weight: page_item._weight, form: form %}
            <input type="checkbox" class="peer hidden" data-state-store="true" checked id="cb-{{ prefix }}">
            <div class="me-4 w-full peer-checked:block hidden">
              {% assign placeholder_block_item = placeholder[item_name][page_item._key] %}
              {%- liquid
                render 'page/edit/scaffold-input', items: item.attributes, key: "@", prefix: prefix, inputs: inputs, placeholders: placeholder_block_item, values: page_item, icon: 'gear', form: form
                render 'page/edit/scaffold-input', items: item.fields, key: ".", prefix: prefix, inputs: inputs, placeholders: placeholder_block_item, values: page_item, icon: '', form: form
              -%}
            </div>
            <label for="cb-{{ prefix }}" class="select-none cursor-pointer float-end peer-checked:hidden flex items-center justify-between px-2 me-2 w-full bg-gray-200 rounded"><span class="text-gray-400">{{ page_item.name | default: page_item.title }}</span><i class="fa-thin fa-chevron-down"></i></label>
            <label for="cb-{{ prefix }}" class="select-none cursor-pointer float-end peer-checked:inline hidden pt-1.5 pe-2 me-2"><i class="fa-thin fa-chevron-up"></i></label>
            {% render "page/edit/block/item-add-button", index: forloop.index0, page_id:item.id, item_name: item_name, block_index:block_index, length: forloop.length, key: page_item._key, form:form %}
          </div>
        {% endfor %}
      </div>
    {% endfor %}
    <!-- end items -->
  </div>
</div>

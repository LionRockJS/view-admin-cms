{% liquid
  assign attributes = blueprint.attributes
  assign fields = blueprint.fields
  assign items = blueprint.items

%}
<div class="flex">
  <!-- key for view -->
  {% if tokens._type == "label" %}
  <div class="min-w-[20%] me-4">
    {% render 'pagefield/text/dark', label: tokens._type, pattern: "[a-z0-9_-]+", selector:selector, value: tokens._name, placeholder: "key", form: form %}
  </div>
  {% endif %}

  <div class="w-full">
    {%- liquid
      render 'page/edit/scaffold-input', items: attributes, key: "@", prefix: prefix, inputs: inputs, placeholders: placeholder, values: tokens, icon: 'gear', form: "main-form"
      render 'page/edit/scaffold-input', items: fields, key: ".", prefix: prefix, inputs: inputs, placeholders: placeholder, values: tokens, icon: 'gear', form: "main-form"
    -%}
  </div>
</div>

<!-- items -->
{% for item in items %}
{%- liquid
  assign item_name = item.name
  assign item_label = item.name | capitalize
  assign default_items = " " |  split: ","
  assign page_items = tokens[item_name] | default: default_items
  assign page_items = page_items | sort : "_weight"
  assign key = "#" | append: block_index | append: item_name | md5
-%}
<div class="relative">
  <input type="checkbox" class="peer hidden" data-state-store="true" checked="checked" id="toggle-{{ key }}">
  <label class="peer-checked:hidden inline-block cursor-pointer select-none text-gray-400 px-4 mt-4 mb-2 min-w-[20%] text-center bg-gray-200 rounded-full" for="toggle-{{ key }}">{{ item_label }}<i class="far fa-copy ms-2"></i></label>

<div class="hidden peer-checked:block">
    <!-- item name -->

    <div class="inline-flex justify-between min-w-[20%] pt-4 pb-2">
    <label for="toggle-{{ key }}" class="text-ellipsis block font-bold cursor-pointer select-none hover:text-highlight ">{{ item_name | capitalize }}</label>
    <input type="text" pattern="\d+" name="count:{{ block_index }}|{{ item_name }}" value="1"
           form="{{ form | default: "main-form" }}"
           class="mx-2 w-8 text-center bg-white text-black rounded-full py-0.5 text-sm border border-gray-300"
    >
    <button type="submit"
            form="{{ form | default: "main-form" }}"
            class="button-add" name="action" value="block-item-add:{{ block_index }}|{{ item_name }}"><i class="fa-light fa-circle-plus"></i></button>
    </div>

    <div class="w-full">
      {% for page_item in page_items %}
        {% capture prefix %}#{{ block_index }}.{{ item_name }}[{{ page_item._key }}]{% endcapture %}

        <div class="flex flex-row mb-3 relative">
          <div class="absolute -ms-2">
            {% render "page/edit/item/weight", prefix: prefix, weight: page_item._weight, form: form %}
          </div>

          <div class="ps-10 w-full">
            {% assign placeholder_block_item = placeholder[item_name][page_item._key] %}

            {%- liquid
              render 'page/edit/scaffold-input', items: item.attributes, key: "@", prefix: prefix, inputs: inputs, placeholders: placeholder_block_item, values: page_item, icon: 'gear', form: form
              render 'page/edit/scaffold-input', items: item.fields, key: ".", prefix: prefix, inputs: inputs, placeholders: placeholder_block_item, values: page_item, icon: 'gear', form: form
            -%}
          </div>

          <div class="pt-1.5 w-4 me-2">
            {% if forloop.length > 1 %}
              <button type="submit" name="action" value="block-item-delete:{{ block_index }}|{{ item_name }}|{{ page_item._key }}" form="main-form"><i class="fal fa-times"></i></button>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
</div>
</div>
{% endfor %}
<!-- end items -->
{% liquid
  assign attributes = blueprint.attributes
  assign fields = blueprint.fields
  assign items = blueprint.items

%}
<div>
    {%- liquid
      render 'page/edit/scaffold-input', items: attributes, key: "@", prefix: prefix, inputs: inputs, placeholders: placeholder, values: tokens, icon: 'gear', form: "main-form"
      render 'page/edit/scaffold-input', items: fields, key: ".", prefix: prefix, inputs: inputs, placeholders: placeholder, values: tokens, icon: 'gear', form: "main-form"
    -%}

    <!-- items -->
    <div class="relative">
      {% for item in items %}
        {%- liquid
          assign item_name = item.name
          assign item_label = item.name | capitalize
          assign default_items = " " |  split: ","
          assign page_items = tokens[item_name] | default: default_items
          assign page_items = page_items | sort : "_weight"
          assign key = "#" | append: block_index | append: item_name | md5
        -%}
        <!-- item name -->
        <input type="checkbox" class="peer hidden" data-state-store="true" checked="checked" id="toggle-{{ key }}">
        <label class="peer-checked:hidden inline-block cursor-pointer select-none font-bold text-white bg-black px-4 my-4" for="toggle-{{ key }}">{{ item_label }}<i class="far fa-copy ms-2"></i></label>

        <form
            action="/admin/pages/{{ page_id }}?language={{ language }}"
            method="post"
            class="hidden peer-checked:flex items-center my-4"
        >
          <label for="toggle-{{ key }}" class="block font-bold cursor-pointer select-none hover:text-highlight">{{ item_name | capitalize }}</label>
          <button type="submit" class="button-add mx-2" name="action" value="block-item-add:{{ block_index }}|{{ item_name }}"><i class="fas fa-plus-circle"></i></button>

          <input type="text" pattern="\d+" name="count:{{ block_index }}|{{ item_name }}" value="1"
                 class="w-8 text-center bg-black text-white rounded-full py-0.5 text-sm">
        </form>

        <div class="hidden peer-checked:block mt-3">
          {% for page_item in page_items %}
            {% capture prefix %}#{{ block_index }}.{{ item_name }}[{{ page_item._key }}]{% endcapture %}

            <div class="flex flex-row mb-3">
              <div class="me-2">
                {% render "page/edit/item/weight", prefix: prefix, weight: page_item._weight %}
              </div>

              <input type="checkbox" class="peer hidden" data-state-store="true" checked id="toggle-{{ prefix }}">
              <div class="me-4 w-full peer-checked:block hidden">
                {% assign placeholder_block_item = placeholder[item_name][page_item._key] %}

                {%- liquid
                  render 'page/edit/scaffold-input', items: item.attributes, key: "@", prefix: prefix, inputs: inputs, placeholders: placeholder_block_item, values: page_item, icon: 'gear', form: "main-form"
                  render 'page/edit/scaffold-input', items: item.fields, key: ".", prefix: prefix, inputs: inputs, placeholders: placeholder_block_item, values: page_item, icon: 'gear', form: "main-form"
                -%}
              </div>

              <label for="toggle-{{ prefix }}" class="cursor-pointer float-end peer-checked:hidden flex items-center justify-between px-2 me-2 w-full bg-gray-200 rounded"><span class="text-gray-400">{{ page_item.name | default: page_item.title }}</span><i class="fa-thin fa-chevron-down"></i></label>
              <label for="toggle-{{ prefix }}" class="cursor-pointer float-end peer-checked:inline hidden pt-1.5 pe-2 me-2"><i class="fa-thin fa-chevron-up"></i></label>

              <div class="pt-1.5 w-4 me-2">
                {% if forloop.length > 1 %}
                  <button type="submit" name="action" value="block-item-delete:{{ block_index }}|{{ item_name }}|{{ page_item._key }}" form="main-form"><i class="fal fa-times"></i></button>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% endfor %}
      <!-- end items -->
    </div>
</div>
